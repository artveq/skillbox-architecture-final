# 10. Архитектурные опции и обоснование выбора

## 1. Архитектурный стиль: микросервисы vs модульный монолит

**Варианты:**  
- A.Модульный монолит  
- B.Микросервисная архитектура (domain-oriented, event-driven)  

**Анализ:**
- Модульный монолит проще в начальной реализации, но:
  - сложнее масштабировать по доменам,
  - выше риск “big ball of mud” при росте команд,
  - сложнее эволюционировать под разные рынки и интеграции.
- Микросервисы:
  - позволяют масштабировать Training, Social, Analytics независимо,
  - хорошо сочетаются с event-driven подходом,
  - поддерживают независимые релизы и команды.

**Выбор:** **B. Микросервисная архитектура**

**Обоснование:**
- Критические сценарии (тренировки, челленджи, рекомендации) имеют разные профили нагрузки.  
- Требования по масштабируемости и интероперабельности (NFR) лучше удовлетворяются микросервисами.  
- Концептуальная архитектура уже выделяет домены: Training, Social, Gamification, Inventory, Analytics.


## 2. Стиль интеграции: синхронный REST vs event-driven

**Варианты:**
- A.Только синхронные REST-вызовы между сервисами  
- B.Гибрид: REST + event-driven (Event Bus как “хребет” интеграции)

**Анализ:**
- Только REST:
  - жёсткие зависимости,
  - каскадные сбои,
  - плохо переносит пики (массовые челленджи, телеметрия).
- Гибрид:
  - REST для запросов/команд (API Gateway → сервисы),
  - события для реакций и асинхронных процессов (Analytics, Leaderboard, Recommendations).

**Выбор:** **B. Гибрид REST + event-driven**

**Обоснование:**
- Концептуальная архитектура уже содержит Event Bus и Message Queues.  
- Критические сценарии (лента, челленджи, аналитика) естественно ложатся на события.  
- NFR по масштабируемости, надёжности и наблюдаемости лучше реализуются через event-driven.


## 3. API-слой: единый шлюз vs сегментированные шлюзы

**Варианты:**

- A.Один общий API Gateway для всех клиентов и интеграций  
- B.Сегментация: External API Gateway, Internal API Gateway, IoT Gateway

**Анализ:**
- Один шлюз:
  - проще в управлении,
  - но смешивает внешние, внутренние и IoT-нагрузки,
  - усложняет безопасность и политику rate limiting.
- Сегментация:
  - разные политики безопасности и лимитов,
  - разные профили нагрузки (IoT vs mobile),
  - чёткое разделение контрактов (public vs internal).

**Выбор:** **B. Сегментированные шлюзы**

**Обоснование:**
- Концептуальная архитектура уже выделяет External, Internal и IoT Gateway.  
- NFR по безопасности, compliance и интероперабельности требуют разделения контуров.  
- Упрощает эволюцию внутренних API без риска ломать внешние.


## 4. Хранение данных: глобальное хранилище vs региональные сторы + глобальная аналитика

**Варианты:**
- A.Единое глобальное хранилище для всех данных  
- B.Региональные хранилища для оперативных данных + глобальный Data Lake / DWH

**Анализ:**
- Глобальное хранилище:
  - проще логически,
  - но проблемы с задержками и законами (GDPR, локальные требования),
  - сложнее обеспечить data locality.
- Региональные сторы + глобальная аналитика:
  - оперативные данные рядом с пользователем,
  - аналитика агрегируется в Data Lake,
  - лучше соответствие требованиям законодательства.

**Выбор:** **B. Региональные сторы + глобальный Data Lake**

**Обоснование:**
- Концептуальная архитектура: региональные базы + Data Lake / DWH.  
- NFR по compliance (GDPR, локальные законы) и производительности (низкая задержка).  
- Критический сценарий “региональное хранение и обработка данных” прямо требует такого подхода.


## 5. Интеграция с устройствами: прямой доступ сервисов vs IoT Gateway

**Варианты:**
- A.Каждый сервис сам работает с устройствами  
- B.Выделенный IoT Gateway как единая точка входа для устройств

**Анализ:**
- Прямой доступ:
  - дублирование логики протоколов,
  - сложность управления безопасностью,
  - сложнее масштабировать.
- IoT Gateway:
  - единая точка аутентификации устройств,
  - единая реализация протоколов (BLE, MQTT, HTTPS),
  - буферизация и QoS.

**Выбор:** **B. IoT Gateway**

**Обоснование:**
- Концептуальная архитектура уже содержит IoT Gateway.  
- NFR по интероперабельности и масштабируемости устройств.  
- Критический сценарий “подключение и синхронизация устройств” требует централизованного решения.


## 6. Облачная стратегия: один провайдер vs мультиоблако

**Опции:**
- A.Один облачный провайдер (single-cloud)  
- B.Мультиоблачная стратегия (multi-cloud)

**Анализ:**
- Single-cloud проще, но создаёт vendor lock-in, ограничивает размещение данных по странам и повышает риски глобального отказа.
- Multi-cloud сложнее, но обеспечивает гибкость, соответствие локальным законам, снижение рисков и оптимизацию стоимости.

**Выбор:** **B. Мультиоблачная стратегия**

**Обоснование:**
- Требования по compliance (GDPR, локальные законы) требуют регионального размещения данных.  
- Критические сценарии (низкая задержка, глобальная доступность) лучше поддерживаются мультиоблаком.  
- Концептуальная архитектура уже предполагает независимые зоны и региональные сторы, что естественно ложится на multi-cloud.


---

Выбранные архитектурные опции согласованы с концептуальной архитектурой и NFR:

- **Микросервисы + event-driven:** масштабируемость, надёжность, независимые домены.  
- **Сегментированные API-шлюзы:** → безопасность, интероперабельность, управление нагрузкой.  
- **Региональные сторы + глобальный Data Lake, мультиоблако:** → производительность и соблюдение законодательства.  
- **IoT Gateway:** → управляемая интеграция устройств.  
- **Отдельные аналитические сервисы:**  поддержка рекомендаций и глобальной аналитики.
